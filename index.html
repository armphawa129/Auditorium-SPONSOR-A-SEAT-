<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Theater Seating - Public View (Live)</title>
    <style>
        :root { --gold: #ffd700; --dark-gold: #b8860b; --bg-dark: #0f172a; --seat-blue: #1e40af; --stair-step: rgba(255, 255, 255, 0.05); --danger: #ef4444; --highlight: #22c55e; }
        body { background-color: var(--bg-dark); color: white; font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px 0; margin: 0; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.85); display: none; justify-content: center; align-items: center; z-index: 5000; font-weight: bold; color: var(--gold); }
        .search-container { margin-bottom: 30px; position: sticky; top: 20px; z-index: 1000; width: 400px; }
        #seatSearch { width: 100%; padding: 12px 20px; border-radius: 50px; border: 2px solid var(--gold); background: rgba(30, 41, 59, 0.9); color: white; font-size: 16px; outline: none; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); backdrop-filter: blur(10px); }
        .cinema-container { display: flex; flex-direction: column-reverse; align-items: center; gap: 10px; padding: 40px 20px; background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%); box-shadow: 0 0 50px rgba(0,0,0,0.5); position: relative; }
        .zone { display: flex; flex-direction: column; gap: 8px; margin-bottom: 50px; position: relative; }
        .row { display: flex; align-items: center; justify-content: center; position: relative; }
        .row-label { width: 45px; font-weight: bold; text-align: center; color: #64748b; font-size: 13px; }
        .block { display: flex; gap: 3px; }
        .aisle-stairs { width: 35px; height: 20px; margin: 0 12px; background: linear-gradient(to bottom, transparent 50%, var(--stair-step) 50%); background-size: 100% 4px; opacity: 0.7; }
        .block-center { display: flex; gap: 3px; width: 335px; justify-content: center; }
        .stairs-center { width: 126px; height: 18px; background: linear-gradient(to bottom, transparent 50%, rgba(255,255,255,0.08) 50%); background-size: 100% 4px; border-left: 1px solid #475569; border-right: 1px solid #475569; display: flex; align-items: center; justify-content: center; }
        .stairs-center::after { content: "stairs"; font-size: 8px; color: #475569; text-transform: uppercase; }
        .control-desk-box { position: absolute; width: 335px; height: 44px; background: #1e293b; border: 2px solid var(--gold); border-radius: 4px; z-index: 100; top: -2px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: var(--gold); letter-spacing: 1px; }
        .seat { width: 18px; height: 18px; background-color: var(--seat-blue); color: white; font-size: 8px; display: flex; align-items: center; justify-content: center; border-radius: 3px 3px 1px 1px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .seat:hover { background-color: #3b82f6; transform: scale(1.3); z-index: 50; }
        .seat.booked { background: linear-gradient(145deg, var(--gold), var(--dark-gold)); color: #5c4033; font-weight: bold; cursor: pointer; }
        .seat.search-match { transform: scale(1.8); z-index: 100; box-shadow: 0 0 15px var(--highlight); border: 2px solid var(--highlight); }
        .stage { width: 650px; height: 50px; background: linear-gradient(to top, #475569, #1e293b); border-radius: 100px 100px 0 0; display: flex; align-items: center; justify-content: center; font-weight: bold; letter-spacing: 10px; margin-bottom: 60px; border-top: 2px solid #94a3b8; }
        .status-bar { position: fixed; bottom: 20px; background: rgba(15, 23, 42, 0.95); padding: 12px 40px; border: 2px solid var(--gold); border-radius: 50px; z-index: 2000; font-weight: bold; }
        .status-bar span { color: var(--gold); font-size: 1.1em; }
        
        /* Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Staff ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô) */
        .modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background-color: #1e293b; margin: 8% auto; padding: 30px; border: 2px solid var(--gold); width: 350px; border-radius: 20px; text-align: center; }
        .price-tag { color: var(--gold); font-weight: bold; font-size: 18px; margin: 10px 0; padding: 10px; border: 1px dashed var(--gold); border-radius: 10px; }
        .input-group { text-align: left; margin-bottom: 12px; }
        .input-group label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 4px; }
        .input-group input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn-confirm { background-color: var(--gold); color: #000; padding: 12px; border: none; font-weight: bold; cursor: pointer; border-radius: 8px; width: 100%; margin-top: 10px; }
        .btn-cancel-booking { background-color: var(--danger); color: white; padding: 12px; border: none; font-weight: bold; cursor: pointer; border-radius: 8px; width: 100%; margin-top: 8px; display: none; }
        .btn-close { background: none; color: #94a3b8; border: none; cursor: pointer; margin-top: 10px; text-decoration: underline; }
    </style>
</head>
<body>

    <div id="loader">UPDATING SEATING PLAN...</div>

    <div class="search-container">
        <input type="text" id="seatSearch" placeholder="üîç Search seats by name..." oninput="handleSearch()">
    </div>

    <div class="cinema-container">
        <div class="stage">STAGE</div>
        <div id="lowerZone" class="zone"></div>
        <div id="midZone" class="zone"></div>
        <div id="upperZone" class="zone"></div>
    </div>

    <div class="status-bar">
        Booked: <span id="bookedCount">0</span> / 720 Seats
    </div>

    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Registration</h3>
            <p id="seatDisplay" style="color:var(--gold); font-weight:bold;"></p>
            <div class="price-tag">Value: 20,000 THB</div>
            <div class="input-group">
                <label>Display Name</label>
                <input type="text" id="displayName">
            </div>
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="realFullName">
            </div>
            <button onclick="saveBooking()" class="btn-confirm">CONFIRM</button>
            <button id="cancelBookingBtn" onclick="cancelBooking()" class="btn-cancel-booking">CANCEL BOOKING</button>
            <button onclick="closeModal()" class="btn-close">Close</button>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ!)
        // ==========================================
        const isAdmin = false; 
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw2S3YOLRDAP7O_9B-MU4NRk79_mXyd2pnLCShbEauRAE1nPYO2wfy7qIJM1ptITxQu/exec";
        // ==========================================

        let selectedSeatElement = null;
        const plans = {
            lower: [{ r: 'H', l: 11, c: 16, ri: 11 }, { r: 'G', l: 11, c: 15, ri: 11 }, { r: 'F', l: 10, c: 16, ri: 10 }, { r: 'E', l: 10, c: 15, ri: 10 }, { r: 'D', l: 9,  c: 16, ri: 9 },  { r: 'C', l: 9,  c: 15, ri: 9 }, { r: 'B', l: 8,  c: 16, ri: 8 },  { r: 'A', l: 6,  c: 15, ri: 6 }],
            mid: [{ r: 'M', l: 14, c: 16, ri: 14 }, { r: 'L', l: 14, c: 15, ri: 14 }, { r: 'K', l: 13, c: 16, ri: 13 }, { r: 'J', l: 13, c: 15, ri: 13 }],
            upper: [{ r: 'U', l: 16, c: 0, ri: 16, hasControl: true }, { r: 'T', l: 16, c: 0, ri: 16 }, { r: 'S', l: 16, c: 16, ri: 16 }, { r: 'R', l: 16, c: "stairs", ri: 16 }, { r: 'Q', l: 16, c: "stairs", ri: 16 }, { r: 'P', l: 16, c: "stairs", ri: 16 }, { r: 'N', l: 15, c: "stairs", ri: 15 }]
        };

        function renderZone(zoneId, data) {
            const container = document.getElementById(zoneId);
            data.forEach(item => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                rowDiv.appendChild(createLabel(item.r));
                const leftBlock = document.createElement('div');
                leftBlock.className = 'block';
                let leftStartNum = 16 - (item.l - 1);
                for (let i = 0; i < item.l; i++) createSeat(leftBlock, item.r, leftStartNum + i);
                rowDiv.appendChild(leftBlock);
                rowDiv.appendChild(Object.assign(document.createElement('div'), {className:'aisle-stairs'}));
                const midBlock = document.createElement('div');
                midBlock.className = 'block-center';
                if (item.c === "stairs") {
                    for(let i=17; i<=21; i++) createSeat(midBlock, item.r, i);
                    midBlock.appendChild(Object.assign(document.createElement('div'), {className:'stairs-center'}));
                    for(let i=28; i<=32; i++) createSeat(midBlock, item.r, i);
                } else if (item.c === 0) {
                    if (item.hasControl) {
                        const desk = document.createElement('div');
                        desk.className = 'control-desk-box'; desk.innerText = "CONTROL DESK";
                        midBlock.appendChild(desk);
                    }
                } else {
                    for (let i = 0; i < item.c; i++) createSeat(midBlock, item.r, 17 + i);
                }
                rowDiv.appendChild(midBlock);
                rowDiv.appendChild(Object.assign(document.createElement('div'), {className:'aisle-stairs'}));
                const rightBlock = document.createElement('div');
                rightBlock.className = 'block';
                for (let i = 0; i < item.ri; i++) createSeat(rightBlock, item.r, 33 + i);
                rowDiv.appendChild(rightBlock);
                rowDiv.appendChild(createLabel(item.r));
                container.appendChild(rowDiv);
            });
        }

        function createSeat(parent, rowName, seatNumber) {
            const seatId = `${rowName}-${seatNumber}`;
            const seat = document.createElement('div');
            seat.className = 'seat';
            seat.id = seatId;
            seat.innerText = seatNumber;
            seat.dataset.originalNo = seatNumber;
            seat.onclick = () => {
                // LOCK ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                if (!isAdmin) {
                    alert("Please contact our staff to reserve this seat.");
                    return;
                }
                
                selectedSeatElement = seat;
                document.getElementById('seatDisplay').innerText = `ROW ${rowName} - SEAT ${seatNumber}`;
                document.getElementById('displayName').value = seat.dataset.displayName || "";
                document.getElementById('realFullName').value = seat.dataset.realName || "";
                document.getElementById('cancelBookingBtn').style.display = seat.classList.contains('booked') ? 'block' : 'none';
                document.getElementById('bookingModal').style.display = 'block';
            };
            parent.appendChild(seat);
        }

        async function fetchBookings() {
            try {
                const res = await fetch(WEB_APP_URL);
                const data = await res.json();
                document.querySelectorAll('.seat').forEach(s => {
                    const saved = data[s.id];
                    if (saved) {
                        s.dataset.displayName = saved.disp;
                        s.dataset.realName = saved.real;
                        s.classList.add('booked');
                        s.innerText = '‚òÖ';
                        s.title = `Owner: ${saved.disp}`;
                    } else {
                        s.classList.remove('booked');
                        s.innerText = s.dataset.originalNo;
                        s.removeAttribute('title');
                    }
                });
                updateSummary();
            } catch(e) { console.error("Sync Error", e); }
        }

        async function saveBooking() {
            if (!isAdmin) return;
            const disp = document.getElementById('displayName').value.trim();
            const real = document.getElementById('realFullName').value.trim();
            if(!disp || !real) return alert("Please fill all fields.");
            selectedSeatElement.dataset.displayName = disp;
            selectedSeatElement.dataset.realName = real;
            selectedSeatElement.classList.add('booked');
            selectedSeatElement.innerText = '‚òÖ';
            closeModal();
            updateSummary();
            await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'add', seatId: selectedSeatElement.id, disp, real }) });
            setTimeout(fetchBookings, 3000);
        }

        async function cancelBooking() {
            if (!isAdmin || !confirm("Cancel this booking?")) return;
            selectedSeatElement.classList.remove('booked');
            selectedSeatElement.innerText = selectedSeatElement.dataset.originalNo;
            closeModal();
            updateSummary();
            await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'remove', seatId: selectedSeatElement.id }) });
            setTimeout(fetchBookings, 3000);
        }

        function handleSearch() {
            const query = document.getElementById('seatSearch').value.toLowerCase().trim();
            document.querySelectorAll('.seat').forEach(seat => {
                seat.classList.remove('search-match');
                if (query !== "") {
                    const disp = (seat.dataset.displayName || "").toLowerCase();
                    const real = (seat.dataset.realName || "").toLowerCase();
                    if (disp.includes(query) || real.includes(query)) seat.classList.add('search-match');
                }
            });
        }

        function closeModal() { document.getElementById('bookingModal').style.display = 'none'; }
        function updateSummary() { document.getElementById('bookedCount').innerText = document.querySelectorAll('.seat.booked').length; }
        function createLabel(text) { const el = document.createElement('div'); el.className = 'row-label'; el.innerText = text; return el; }

        renderZone('lowerZone', plans.lower);
        renderZone('midZone', plans.mid);
        renderZone('upperZone', plans.upper);
        
        document.getElementById('loader').style.display = 'flex';
        fetchBookings().then(() => { document.getElementById('loader').style.display = 'none'; });
        setInterval(fetchBookings, 10000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    </script>
</body>
</html>